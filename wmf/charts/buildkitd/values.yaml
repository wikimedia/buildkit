# Default values for buildkitd.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: docker-registry.wikimedia.org/repos/releng/buildkit
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podSecurityContext: {}

securityContext: {}
#  Example settings for rootless mode:
#
#  seccompProfile:
#    type: Unconfined
#  # To change UID/GID, you need to rebuild the image
#  runAsUser: 1000
#  runAsGroup: 1000
#
#  Example settings for privileged mode:
#
#  privileged: true

service:
  type: ClusterIP
  port: 1234

mtls:
  enabled: false
  # the mTLS secret must contain: ca.pem, cert.pem, and key.pem
  secretName: ""

resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 80
#   - type: Resource
#     resource:
#       name: memory
#       target:
#         type: Utilization
#         averageUtilization: 80

nodeSelector: {}

tolerations: []

affinity: {}

# If enabled, a PersistentVolumeClaim will be used to hold /var/lib/buildkit.
# You must supply a value for persistentVolumeClaimStorage.size!
persistentVolumeClaimStorage:
  enabled: false
  # If blank, the default storage class will be used.
  storageClassName: ""
  #size: "20Gi"

cacheStorage:
  # S3 credentials can be provide via a secret. buildctl clients can then do:
  # `--export-cache type=s3,region=eu-west-1,bucket=my_bucket,name=my_image`
  # `--import-cache type=s3,region=eu-west-1,bucket=my_bucket,name=my_image`
  s3:
    # Whether S3 credentials are provided to buildkitd
    enabled: false

    # The name of the secret that contains the access ID and secret key
    secretName: ""

    # The key within the above secret's data that defines the access ID value
    accessID: "access_id"

    # The key within the above secret's data that defines the secret key value
    secretKey: "secret_key"

    # The key within the above secret's data that defines the default region
    region:  "region"

insecureRegistries: []

# For full control over buildkitd.toml, use this.
# See https://github.com/moby/buildkit/blob/master/docs/buildkitd.toml.md
buildkitdToml: ""

# Container Network Interface (CNI) configuration to use when the worker
# `networkMode` (which can be set via buildkitdToml above) is "cni".
#
# See https://github.com/moby/buildkit/blob/master/docs/cni-networking.md
# See https://github.com/moby/buildkit/blob/master/hack/fixtures/cni.json
# See https://www.cni.dev/plugins/current/main/bridge/
#
# The following configuration can be used to isolate build containers in their
# own network.
#
# cniConfig:
#   cniVersion: 1.0.0
#   name: buildkit
#   type: bridge
#   bridge: buildkit0
#   isDefaultGateway: true
#   forceAddress: false
#   ipMasq: true
#   hairpinMode: true
#   ipam:
#     type: host-local
#     ranges:
#     - - subnet: 10.10.0.0/16
# Max connection limit enforced by istio DestinationRule
# trafficPolicy:
    # loadBalancer:
      # Ensure that all requests for a given runner client hit the same
      # buildkitd instance
      # consistentHash:
        # useSourceIp: true
    # connectionPool:
      # tcp:
        # maxConnections: 10
